<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expedition - Space Exploration</title>
    <link rel="stylesheet" href="css/ui.css">
</head>
<body>
    <!-- Splash / Title Screen -->
    <div id="splash-screen">
        <canvas id="splash-bg-canvas"></canvas>
        <div class="splash-content">
            <div class="splash-skippy-container" id="splash-skippy-container">
                <div id="splash-skippy-speech" class="splash-skippy-speech"></div>
            </div>
            <h1 class="splash-title">EXPEDITION</h1>
            <p class="splash-subtitle">A Space Exploration Game</p>
            <div class="splash-menu" id="splash-menu"></div>
            <div class="splash-version">v1.0</div>
        </div>
        <div id="splash-sub-screen" class="splash-sub hidden"></div>
    </div>

    <!-- Three.js Canvas Container -->
    <div id="game-container"></div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Tactical Overlay Container -->
    <div id="tactical-overlay" class="hidden"></div>

    <!-- Damage Flash Overlay -->
    <div id="damage-flash"></div>

    <!-- Hull Emergency Vignette -->
    <div id="hull-vignette" class="hull-vignette"></div>

    <!-- Damage Direction Indicators -->
    <div id="damage-direction-container"></div>

    <!-- Confirmation Dialog -->
    <div id="confirm-dialog" class="confirm-overlay hidden">
        <div class="confirm-dialog-box">
            <div class="confirm-dialog-header">
                <span id="confirm-title">Confirm Action</span>
            </div>
            <div class="confirm-dialog-body">
                <div id="confirm-message"></div>
                <div class="confirm-buttons">
                    <button id="confirm-yes-btn" class="confirm-btn confirm-btn-yes">CONFIRM</button>
                    <button id="confirm-no-btn" class="confirm-btn confirm-btn-no">CANCEL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Tooltip -->
    <div id="global-tooltip" class="global-tooltip hidden"></div>

    <!-- Salvage Beam Container -->
    <div id="salvage-beam-container"></div>

    <!-- Autopilot Route Indicator -->
    <div id="route-indicator" class="hidden">
        <div class="route-arrow">&#9654;</div>
        <div class="route-info">
            <span class="route-dest" id="route-dest-name">--</span>
            <span class="route-jumps" id="route-jump-count">0 jumps</span>
        </div>
    </div>

    <!-- Docking Animation Overlay -->
    <div id="dock-animation" class="dock-anim hidden">
        <div class="dock-anim-bar dock-anim-top"></div>
        <div class="dock-anim-bar dock-anim-bottom"></div>
        <div class="dock-anim-content">
            <div class="dock-anim-icon">&#9632;</div>
            <div id="dock-anim-text" class="dock-anim-text">DOCKING</div>
            <div id="dock-anim-station" class="dock-anim-station"></div>
            <div class="dock-anim-dots"><span>.</span><span>.</span><span>.</span></div>
        </div>
    </div>

    <!-- Credit Popup Container -->
    <div id="credit-popups"></div>

    <!-- Damage Popup Container -->
    <div id="damage-popups"></div>

    <!-- Gate Label Container -->
    <div id="gate-labels"></div>

    <!-- Sector Event Banner -->
    <div id="sector-event-banner" class="sector-event-banner hidden">
        <div class="event-banner-icon" id="event-banner-icon"></div>
        <div class="event-banner-text">
            <div class="event-banner-title" id="event-banner-title">EVENT</div>
            <div class="event-banner-desc" id="event-banner-desc"></div>
        </div>
        <div class="event-banner-timer" id="event-banner-timer"></div>
    </div>

    <!-- UI Overlay -->
    <div id="ui-overlay">
        <!-- Bottom Bar: Ship Status HUD -->
        <div id="bottom-bar">
            <!-- Left: Speed & Heading -->
            <div class="left-section">
                <div id="speed-display">
                    <span id="speed-value">0</span>
                    <span class="unit">m/s</span>
                </div>
                <div id="heading-display">
                    <div class="heading-compass">
                        <svg id="compass-ring" width="44" height="44" viewBox="0 0 44 44">
                            <circle cx="22" cy="22" r="19" fill="none" stroke="rgba(0,255,255,0.15)" stroke-width="1"/>
                            <line id="compass-needle" x1="22" y1="22" x2="22" y2="6" stroke="var(--primary-cyan)" stroke-width="1.5" stroke-linecap="round"/>
                            <line id="compass-target-bearing" x1="22" y1="22" x2="22" y2="8" stroke="var(--hostile-color)" stroke-width="1" stroke-linecap="round" stroke-dasharray="2,2" opacity="0"/>
                            <text x="22" y="7" text-anchor="middle" fill="rgba(0,255,255,0.3)" font-size="5">N</text>
                        </svg>
                    </div>
                    <div class="heading-text">
                        <span id="heading-degrees">000</span><span class="heading-unit">&deg;</span>
                        <span id="heading-cardinal" class="heading-cardinal">N</span>
                    </div>
                </div>
            </div>

            <!-- Center: Ship Status Bars -->
            <div class="center-section">
                <div id="ship-status">
                    <div class="status-group">
                        <label>SHIELD</label>
                        <div class="bar-container">
                            <div id="shield-bar" class="status-bar shield"></div>
                            <span id="shield-text">100%</span>
                        </div>
                    </div>
                    <div class="status-group">
                        <label>ARMOR</label>
                        <div class="bar-container">
                            <div id="armor-bar" class="status-bar armor"></div>
                            <span id="armor-text">100%</span>
                        </div>
                    </div>
                    <div class="status-group">
                        <label>HULL</label>
                        <div class="bar-container">
                            <div id="hull-bar" class="status-bar hull"></div>
                            <span id="hull-text">100%</span>
                        </div>
                    </div>
                    <div class="status-group cap-ring-group">
                        <label>CAPACITOR</label>
                        <div class="bar-container">
                            <div id="capacitor-bar" class="status-bar capacitor"></div>
                            <span id="capacitor-text">100%</span>
                        </div>
                        <svg id="cap-ring" class="cap-ring" viewBox="0 0 44 44">
                            <circle class="cap-ring-bg" cx="22" cy="22" r="19"></circle>
                            <circle id="cap-ring-fill" class="cap-ring-fill" cx="22" cy="22" r="19"></circle>
                        </svg>
                    </div>
                    <div class="status-group">
                        <label>CARGO</label>
                        <div class="bar-container">
                            <div id="cargo-bar" class="status-bar cargo"></div>
                            <span id="cargo-text">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: ISK, Cargo, Settings -->
            <div class="right-section">
                <div id="credits-display">
                    <span class="label">ISK</span>
                    <span id="credits-value">10,000</span>
                </div>
                <div id="faction-treasury-display" class="faction-treasury-display" title="Faction Treasury">
                    <span class="faction-treasury-icon">&#9733;</span>
                    <span id="faction-treasury-value">0</span>
                </div>
                <div id="cargo-display">
                    <span class="label">CARGO</span>
                    <div class="cargo-bar-container">
                        <div id="cargo-bar" class="cargo-bar"></div>
                        <span id="cargo-text">0 / 200 m³</span>
                    </div>
                </div>
                <div id="stardate-display" class="stardate-display" title="Stardate (Game Time)">
                    <span class="stardate-label">SD</span>
                    <span id="stardate-value">3301.001.00</span>
                </div>
                <div id="danger-indicator" title="Sector Security Level">
                    <span class="danger-label">SEC</span>
                    <span id="danger-level" class="danger-safe">1.0</span>
                </div>
                <button id="settings-btn" title="Settings (Esc)">&#9881;</button>
            </div>
        </div>

        <!-- Left Panel: Target Info -->
        <div id="target-panel" class="panel hidden">
            <div class="panel-header">
                <span class="panel-title">TARGET</span>
                <button class="panel-close">&times;</button>
            </div>
            <div class="panel-content">
                <div id="target-name" class="target-name">No Target</div>
                <div id="target-type" class="target-type"></div>
                <div id="target-distance" class="target-distance"></div>
                <div id="target-health-bars">
                    <div class="mini-bar-group">
                        <div id="target-shield-bar" class="mini-bar shield"></div>
                    </div>
                    <div class="mini-bar-group">
                        <div id="target-armor-bar" class="mini-bar armor"></div>
                    </div>
                    <div class="mini-bar-group">
                        <div id="target-hull-bar" class="mini-bar hull"></div>
                    </div>
                </div>
                <div id="target-combat-info" class="target-combat-info">
                    <div class="combat-info-row">
                        <span class="combat-info-label">DPS OUT</span>
                        <span class="combat-info-value" id="target-dps-out">0</span>
                    </div>
                    <div class="combat-info-row">
                        <span class="combat-info-label">SPEED</span>
                        <span class="combat-info-value" id="target-speed-val">0 m/s</span>
                    </div>
                    <div class="combat-info-row">
                        <span class="combat-info-label">ANGULAR</span>
                        <span class="combat-info-value" id="target-angular-val">0</span>
                    </div>
                </div>
                <!-- Scanner Readout (expanded ship data) -->
                <div id="target-scanner" class="target-scanner">
                    <div class="scanner-divider"></div>
                    <div class="scanner-grid">
                        <div class="scanner-row">
                            <span class="scanner-label">SPEED</span>
                            <span class="scanner-value" id="scan-speed">--</span>
                        </div>
                        <div class="scanner-row">
                            <span class="scanner-label">HEADING</span>
                            <span class="scanner-value" id="scan-heading">--</span>
                        </div>
                        <div class="scanner-row">
                            <span class="scanner-label">TRANSVERSAL</span>
                            <span class="scanner-value" id="scan-transversal">--</span>
                        </div>
                        <div class="scanner-row">
                            <span class="scanner-label">ANG VELOCITY</span>
                            <span class="scanner-value" id="scan-angular">--</span>
                        </div>
                        <div class="scanner-row">
                            <span class="scanner-label">SIGNATURE</span>
                            <span class="scanner-value" id="scan-signature">--</span>
                        </div>
                        <div class="scanner-row">
                            <span class="scanner-label">CARGO</span>
                            <span class="scanner-value" id="scan-cargo">--</span>
                        </div>
                    </div>
                    <div class="scanner-ewar" id="scan-ewar"></div>
                    <div class="scanner-modules" id="scan-modules"></div>
                    <div class="scanner-divider"></div>
                    <div class="scanner-dps">
                        <div class="scanner-row">
                            <span class="scanner-label">INCOMING DPS</span>
                            <span class="scanner-value dps-incoming" id="scan-dps-incoming">0</span>
                        </div>
                        <div class="scanner-row">
                            <span class="scanner-label">OUTGOING DPS</span>
                            <span class="scanner-value dps-outgoing" id="scan-dps-outgoing">0</span>
                        </div>
                    </div>
                </div>
                <div id="threat-list" class="threat-list hidden">
                    <div class="scanner-divider"></div>
                    <div class="threat-header">THREATS TARGETING YOU</div>
                    <div id="threat-list-body"></div>
                </div>
            </div>
        </div>

        <!-- Locked Targets Display -->
        <div id="locked-targets-container" class="panel">
            <div class="panel-header locked-targets-header">
                <span class="panel-title">LOCKED</span>
            </div>
            <div class="locked-targets-content">
                <!-- Dynamically populated with locked target icons -->
            </div>
        </div>

        <!-- Right Panel: Overview -->
        <div id="overview-panel" class="panel">
            <div class="panel-header">
                <span class="panel-title">OVERVIEW</span>
                <div id="overview-filters">
                    <button class="filter-btn active" data-filter="all" title="All">ALL</button>
                    <button class="filter-btn" data-filter="ships" title="Ships">&#9650;</button>
                    <button class="filter-btn" data-filter="stations" title="Stations">&#9632;</button>
                    <button class="filter-btn" data-filter="asteroids" title="Asteroids">&#9671;</button>
                    <button class="filter-btn" data-filter="gates" title="Gates">&#10070;</button>
                    <button class="filter-btn" data-filter="anomalies" title="Anomalies">&#10059;</button>
                </div>
            </div>
            <div class="panel-content">
                <table id="overview-table">
                    <thead>
                        <tr>
                            <th class="col-icon" data-sort="icon"></th>
                            <th class="col-name sortable" data-sort="name">Name</th>
                            <th class="col-type sortable" data-sort="type">Type</th>
                            <th class="col-dist sortable active-sort sort-asc" data-sort="dist">Dist</th>
                            <th class="col-vel sortable" data-sort="vel">Vel</th>
                            <th class="col-ang sortable" data-sort="ang">Ang</th>
                        </tr>
                    </thead>
                    <tbody id="overview-body">
                        <!-- Dynamically populated -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Power Routing Panel -->
        <div id="power-routing">
            <div class="power-channel" data-channel="weapons">
                <div class="power-label">WPN</div>
                <div class="power-slider-track">
                    <div class="power-slider-fill" id="power-weapons-fill"></div>
                </div>
                <div class="power-value" id="power-weapons-val">33</div>
            </div>
            <div class="power-channel" data-channel="shields">
                <div class="power-label">SHD</div>
                <div class="power-slider-track">
                    <div class="power-slider-fill" id="power-shields-fill"></div>
                </div>
                <div class="power-value" id="power-shields-val">33</div>
            </div>
            <div class="power-channel" data-channel="engines">
                <div class="power-label">ENG</div>
                <div class="power-slider-track">
                    <div class="power-slider-fill" id="power-engines-fill"></div>
                </div>
                <div class="power-value" id="power-engines-val">34</div>
            </div>
        </div>

        <!-- Bottom Panel: Module Rack (stacked: High top, Mid middle, Low bottom) -->
        <div id="module-rack">
            <div class="module-section">
                <div class="section-label">HIGH</div>
                <div class="module-slots" id="high-slots">
                    <div class="module-slot" data-slot="high-1">
                        <div class="module-icon">&#9889;</div>
                        <div class="module-cooldown"></div>
                    </div>
                    <div class="module-slot" data-slot="high-2">
                        <div class="module-icon">&#9889;</div>
                        <div class="module-cooldown"></div>
                    </div>
                    <div class="module-slot" data-slot="high-3">
                        <div class="module-icon">&#9874;</div>
                        <div class="module-cooldown"></div>
                    </div>
                </div>
            </div>
            <div class="module-section">
                <div class="section-label">MID</div>
                <div class="module-slots" id="mid-slots">
                    <div class="module-slot" data-slot="mid-1">
                        <div class="module-icon">&#9211;</div>
                        <div class="module-cooldown"></div>
                    </div>
                    <div class="module-slot" data-slot="mid-2">
                        <div class="module-icon">&#10148;</div>
                        <div class="module-cooldown"></div>
                    </div>
                </div>
            </div>
            <div class="module-section">
                <div class="section-label">LOW</div>
                <div class="module-slots" id="low-slots">
                    <div class="module-slot" data-slot="low-1">
                        <div class="module-icon">&#9881;</div>
                        <div class="module-cooldown"></div>
                    </div>
                    <div class="module-slot" data-slot="low-2">
                        <div class="module-icon">&#9881;</div>
                        <div class="module-cooldown"></div>
                    </div>
                </div>
            </div>
            <div id="cargo-hud-bar">
                <div id="cargo-hud-fill"></div>
                <span id="cargo-hud-text">0/0 m³</span>
            </div>
        </div>

        <!-- Bottom Left: Event Log -->
        <div id="event-log" class="panel">
            <div class="panel-header">
                <span class="panel-title">EVENT LOG</span>
                <div id="log-filters">
                    <button class="log-filter-btn active" data-log-filter="all">ALL</button>
                    <button class="log-filter-btn" data-log-filter="combat" title="Combat">&#9876;</button>
                    <button class="log-filter-btn" data-log-filter="mining" title="Mining">&#9874;</button>
                    <button class="log-filter-btn" data-log-filter="trade" title="Trade">&#9878;</button>
                    <button class="log-filter-btn" data-log-filter="system" title="System">&#9881;</button>
                </div>
            </div>
            <div class="panel-content">
                <div id="log-messages">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </div>

        <!-- Ship Status Indicator -->
        <div id="ship-indicator" class="panel">
            <div class="panel-header ship-indicator-header">
                <span class="panel-title">SHIP</span>
            </div>
            <div class="ship-indicator-content">
                <canvas id="ship-indicator-canvas"></canvas>
                <div class="ship-indicator-info">
                    <div id="ship-indicator-name" class="ship-indicator-name">Your Ship</div>
                    <div id="ship-indicator-class" class="ship-indicator-class"></div>
                </div>
                <div id="ship-indicator-health">
                    <div class="mini-bar-group">
                        <div id="ship-shield-bar" class="mini-bar shield"></div>
                        <span class="bar-pct" id="ship-shield-pct"></span>
                    </div>
                    <div class="mini-bar-group">
                        <div id="ship-armor-bar" class="mini-bar armor"></div>
                        <span class="bar-pct" id="ship-armor-pct"></span>
                    </div>
                    <div class="mini-bar-group">
                        <div id="ship-hull-bar" class="mini-bar hull"></div>
                        <span class="bar-pct" id="ship-hull-pct"></span>
                    </div>
                    <div class="mini-bar-group">
                        <div id="ship-cap-bar" class="mini-bar capacitor"></div>
                        <span class="bar-pct" id="ship-cap-pct"></span>
                    </div>
                </div>
                <div id="ship-cargo-bar-container" class="mini-bar-group cargo-bar-group">
                    <div id="ship-cargo-bar" class="mini-bar cargo"></div>
                    <span class="cargo-label" id="ship-cargo-label"></span>
                </div>
                <div id="velocity-compass" class="velocity-compass">
                    <canvas id="velocity-compass-canvas" width="50" height="50"></canvas>
                    <span id="velocity-speed-label" class="velocity-speed-label">0 m/s</span>
                </div>
                <div id="hull-warning-text" class="hull-warning-text hidden">HULL CRITICAL</div>
                <div id="ewar-status" class="ewar-status-bar"></div>
            </div>
        </div>

        <!-- Fleet Panel -->
        <div id="fleet-panel" class="panel hidden">
            <div class="panel-header">
                <span class="panel-title">FLEET</span>
                <button class="panel-close">&times;</button>
            </div>
            <div class="fleet-sub-tabs">
                <button class="fleet-sub-tab active" data-subtab="fleet">FLEET</button>
                <button class="fleet-sub-tab" data-subtab="aar">AARs</button>
            </div>
            <div class="panel-content">
                <div id="fleet-panel-body">
                    <div class="fleet-empty">
                        <div>No fleet ships</div>
                        <div class="fleet-hint">Buy ships at stations and add them to your fleet</div>
                    </div>
                </div>
                <div id="aar-panel-body" class="hidden"></div>
            </div>
        </div>

        <!-- Drone Quick Action Bar -->
        <div id="drone-bar" class="panel hidden">
            <div class="panel-header drone-bar-header">
                <span class="panel-title">DRONES</span>
                <span class="drone-count">0/0</span>
            </div>
            <div class="drone-bar-content">
                <div class="drone-commands">
                    <button class="drone-cmd-btn" data-cmd="orbit" title="Orbit Target">&#8635;</button>
                    <button class="drone-cmd-btn" data-cmd="attack" title="Attack Target">&#9876;</button>
                    <button class="drone-cmd-btn" data-cmd="mine" title="Mine Target">&#9874;</button>
                    <button class="drone-cmd-btn" data-cmd="return" title="Return to Bay">&#8617;</button>
                </div>
                <div class="drone-status">Idle</div>
            </div>
        </div>

        <!-- Radar Minimap -->
        <div id="minimap" class="panel">
            <div class="panel-header minimap-header">
                <span class="panel-title">RADAR</span>
                <div class="minimap-range-btns">
                    <button class="minimap-range-btn" data-range="2000">2K</button>
                    <button class="minimap-range-btn active" data-range="5000">5K</button>
                    <button class="minimap-range-btn" data-range="10000">10K</button>
                    <button class="minimap-range-btn" data-range="25000">25K</button>
                    <button id="minimap-expand-btn" class="minimap-range-btn" title="Expand/Collapse">▴</button>
                </div>
            </div>
            <canvas id="minimap-canvas" width="200" height="200"></canvas>
        </div>

        <!-- Hazard Warning HUD -->
        <div id="hazard-warning" class="hidden">
            <span class="hazard-icon">&#9888;</span>
            <span class="hazard-name">HAZARD</span>
        </div>

        <!-- Dock Prompt -->
        <div id="dock-prompt" class="hidden">DOCK &#9166;</div>

        <!-- Autopilot Status Indicator -->
        <div id="autopilot-indicator" class="panel hidden">
            <div class="autopilot-content">
                <span class="autopilot-icon">&#9678;</span>
                <span id="autopilot-status-text">Idle</span>
                <button id="autopilot-cancel-btn" title="Cancel autopilot (Ctrl+Space)">&times;</button>
            </div>
        </div>

        <!-- Context Menu -->
        <div id="context-menu" class="hidden">
            <div class="menu-item" data-action="approach">Approach</div>
            <div class="menu-item has-submenu">
                <span class="submenu-arrow">&#9666;</span>
                Orbit
                <div class="submenu">
                    <div class="submenu-item" data-action="orbit-100">100 m</div>
                    <div class="submenu-item" data-action="orbit-500">500 m</div>
                    <div class="submenu-item" data-action="orbit-1000">1,000 m</div>
                    <div class="submenu-item" data-action="orbit-2500">2,500 m</div>
                    <div class="submenu-item" data-action="orbit-5000">5,000 m</div>
                </div>
            </div>
            <div class="menu-item has-submenu">
                <span class="submenu-arrow">&#9666;</span>
                Keep at Range
                <div class="submenu">
                    <div class="submenu-item" data-action="keep-range-100">100 m</div>
                    <div class="submenu-item" data-action="keep-range-500">500 m</div>
                    <div class="submenu-item" data-action="keep-range-1000">1,000 m</div>
                    <div class="submenu-item" data-action="keep-range-2500">2,500 m</div>
                    <div class="submenu-item" data-action="keep-range-5000">5,000 m</div>
                </div>
            </div>
            <div class="menu-separator"></div>
            <div class="menu-item" data-action="lock">Lock Target</div>
            <div class="menu-item" data-action="look-at">Look At</div>
            <div class="menu-separator"></div>
            <div class="menu-item" data-action="warp">Warp To</div>
            <div class="menu-item" data-action="dock">Dock</div>
            <div class="menu-item" data-action="bookmark">Save Location</div>
        </div>

        <!-- Hyperspace Jump Overlay -->
        <div id="warp-tunnel" class="hidden">
            <canvas id="warp-streaks-canvas"></canvas>
            <div class="warp-vortex"></div>
            <div class="warp-ring warp-ring-1"></div>
            <div class="warp-ring warp-ring-2"></div>
            <div class="warp-ring warp-ring-3"></div>
            <div class="warp-ring warp-ring-4"></div>
            <div class="warp-ring warp-ring-5"></div>
            <div class="warp-stars"></div>
            <div class="warp-lines"></div>
            <div class="warp-flash-overlay"></div>
            <div class="warp-text">
                <span class="warp-text-main">JUMPING</span>
                <span class="warp-text-sector" id="warp-destination"></span>
            </div>
            <div id="warp-destination-text" class="warp-destination-text"></div>
        </div>

        <!-- Sector Arrival Banner -->
        <div id="sector-banner" class="hidden">
            <div class="sector-banner-name" id="sector-banner-name"></div>
            <div class="sector-banner-subtitle" id="sector-banner-subtitle"></div>
        </div>

        <!-- Keyboard Shortcuts Overlay -->
        <div id="keybind-overlay" class="hidden">
            <div class="keybind-container">
                <div class="keybind-header">
                    <span class="keybind-title">&#9881; KEYBOARD REFERENCE</span>
                    <span class="keybind-hint">Press F1 or Esc to close</span>
                </div>
                <div class="keybind-grid" id="keybind-grid"></div>
                <div class="keybind-footer">
                    EXPEDITION v1.0 &bull; Press ? on any UI panel for contextual help
                </div>
            </div>
        </div>

        <!-- Station Panel (Modal) -->
        <div id="station-panel" class="modal hidden">
            <canvas id="station-ambient-canvas"></canvas>
            <div class="modal-content">
                <div class="modal-header">
                    <span id="station-name">Station Name</span>
                    <button class="modal-close" id="undock-btn">UNDOCK</button>
                </div>
                <div id="station-traffic" class="station-traffic">
                    <div class="traffic-log" id="station-traffic-log"></div>
                </div>
                <div id="price-ticker" class="price-ticker">
                    <div class="price-ticker-track" id="price-ticker-track"></div>
                </div>
                <div class="modal-tabs">
                    <button class="tab-btn active" data-tab="hangar">HANGAR</button>
                    <button class="tab-btn" data-tab="ships">SHIPS</button>
                    <button class="tab-btn" data-tab="equipment">EQUIPMENT</button>
                    <button class="tab-btn" data-tab="fitting">FITTING</button>
                    <button class="tab-btn" data-tab="repair">REPAIR</button>
                    <button class="tab-btn" data-tab="refinery">REFINERY</button>
                    <button class="tab-btn" data-tab="cantina">CANTINA</button>
                    <button class="tab-btn" data-tab="guild">GUILDS</button>
                    <button class="tab-btn" data-tab="commerce">COMMERCE</button>
                    <button class="tab-btn" data-tab="insurance">INSURANCE</button>
                    <button class="tab-btn" data-tab="bounty">BOUNTY</button>
                    <button class="tab-btn" data-tab="manufacturing">CRAFT</button>
                    <button class="tab-btn" data-tab="skills">SKILLS</button>
                </div>
                <div class="modal-body">
                    <div id="tab-hangar" class="tab-content active">
                        <h3>Your Ships</h3>
                        <div id="hangar-ships"></div>
                        <h3>Cargo Hold</h3>
                        <div id="cargo-contents"></div>
                    </div>
                    <div id="tab-ships" class="tab-content">
                        <div id="ships-market" class="market-section"></div>
                    </div>
                    <div id="tab-equipment" class="tab-content">
                        <div id="equipment-market" class="market-section"></div>
                    </div>
                    <div id="tab-fitting" class="tab-content">
                        <div id="fitting-display" class="fitting-container"></div>
                    </div>
                    <div id="tab-repair" class="tab-content">
                        <div id="repair-options"></div>
                    </div>
                    <div id="tab-refinery" class="tab-content">
                        <h3>Sell Ore</h3>
                        <div id="refinery-ore-list"></div>
                        <div id="refinery-total"></div>
                        <div class="refinery-actions">
                            <button id="sell-all-ore-btn" class="buy-btn">SELL ALL ORE</button>
                            <button id="refine-all-ore-btn" class="buy-btn refine-btn">REFINE TO INGOTS</button>
                        </div>
                        <div id="refinery-ingot-preview" class="refinery-ingot-preview"></div>
                    </div>
                    <div id="tab-cantina" class="tab-content">
                        <div id="cantina-content"></div>
                    </div>
                    <div id="tab-guild" class="tab-content">
                        <div id="guild-content"></div>
                    </div>
                    <div id="tab-commerce" class="tab-content">
                        <div id="commerce-content"></div>
                    </div>
                    <div id="tab-insurance" class="tab-content">
                        <div id="insurance-content"></div>
                    </div>
                    <div id="tab-bounty" class="tab-content">
                        <div id="bounty-content"></div>
                    </div>
                    <div id="tab-manufacturing" class="tab-content">
                        <div id="manufacturing-content"></div>
                    </div>
                    <div id="tab-skills" class="tab-content">
                        <div id="skills-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Panel -->
        <div id="stats-panel" class="panel hidden">
            <div class="panel-header">
                <span class="panel-title">PILOT STATISTICS</span>
                <button class="panel-close">&times;</button>
            </div>
            <div class="panel-content">
                <div id="stats-content"></div>
            </div>
        </div>

        <!-- Ship Log Panel -->
        <div id="ship-log-panel" class="panel hidden">
            <div class="panel-header">
                <span class="panel-title">SHIP LOG</span>
                <button class="panel-close">&times;</button>
            </div>
            <div class="panel-content">
                <div id="ship-log-filters">
                    <button class="log-filter-btn active" data-ship-log="all">ALL</button>
                    <button class="log-filter-btn" data-ship-log="combat">COMBAT</button>
                    <button class="log-filter-btn" data-ship-log="trade">TRADE</button>
                    <button class="log-filter-btn" data-ship-log="nav">NAV</button>
                    <button class="log-filter-btn" data-ship-log="quest">QUEST</button>
                </div>
                <div id="ship-log-entries"></div>
            </div>
        </div>

        <!-- Combat Log Panel -->
        <div id="combat-log-panel" class="panel hidden">
            <div class="panel-header">
                <span class="panel-title">COMBAT LOG</span>
                <button class="panel-close">&times;</button>
            </div>
            <div class="panel-content">
                <div id="combat-log-summary"></div>
                <div id="combat-log-filters">
                    <button class="clog-filter-btn active" data-clog="all">ALL</button>
                    <button class="clog-filter-btn" data-clog="outgoing">DEALT</button>
                    <button class="clog-filter-btn" data-clog="incoming">TAKEN</button>
                    <button class="clog-filter-btn" data-clog="kills">KILLS</button>
                </div>
                <div id="combat-log-entries"></div>
            </div>
        </div>

        <!-- Achievements Panel -->
        <div id="achievements-panel" class="panel hidden">
            <div class="panel-header">
                <span class="panel-title">ACHIEVEMENTS</span>
                <button class="panel-close">&times;</button>
            </div>
            <div class="panel-content">
                <div id="achievements-content"></div>
            </div>
        </div>

        <!-- D-Scan Panel -->
        <div id="dscan-panel" class="panel hidden">
            <div class="panel-header">
                <span class="panel-title">DIRECTIONAL SCANNER</span>
                <button class="panel-close">&times;</button>
            </div>
            <div class="panel-content">
                <div id="dscan-controls">
                    <div class="dscan-slider-row">
                        <span class="dscan-label">RANGE</span>
                        <input type="range" id="dscan-range" min="1000" max="20000" value="10000" step="500">
                        <span class="dscan-value" id="dscan-range-val">10,000m</span>
                    </div>
                    <div class="dscan-slider-row">
                        <span class="dscan-label">ANGLE</span>
                        <input type="range" id="dscan-angle" min="5" max="360" value="60" step="5">
                        <span class="dscan-value" id="dscan-angle-val">60&#176;</span>
                    </div>
                    <div class="dscan-button-row">
                        <button id="dscan-scan" class="dscan-scan-btn">&#9673; SCAN (V)</button>
                        <button id="dscan-360" class="dscan-preset-btn" title="360&#176; scan">360&#176;</button>
                        <button id="dscan-180" class="dscan-preset-btn" title="180&#176; scan">180&#176;</button>
                        <button id="dscan-60" class="dscan-preset-btn" title="60&#176; scan">60&#176;</button>
                        <button id="dscan-15" class="dscan-preset-btn" title="15&#176; scan">15&#176;</button>
                    </div>
                </div>
                <div class="dscan-summary" id="dscan-summary"></div>
                <div class="dscan-results-wrap">
                    <table class="dscan-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Distance</th>
                            </tr>
                        </thead>
                        <tbody id="dscan-results"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Bookmarks Panel -->
        <div id="bookmarks-panel" class="panel hidden">
            <div class="panel-header">
                <span class="panel-title">BOOKMARKS</span>
                <button class="panel-close">&times;</button>
            </div>
            <div class="panel-content">
                <div id="bookmark-list"></div>
            </div>
        </div>

        <!-- Object Viewer Panel -->
        <div id="object-viewer" class="panel hidden">
            <div class="panel-header">
                <span class="panel-title">OBJECT VIEWER</span>
                <button class="panel-close">&times;</button>
            </div>
            <div class="panel-content">
                <div id="object-viewer-content">
                    <div class="viewer-placeholder">
                        Select an object to view details
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel (Modal) -->
        <div id="settings-panel" class="modal hidden">
            <div class="modal-content settings-modal">
                <div class="modal-header">
                    <span>SETTINGS</span>
                    <button class="modal-close" id="settings-close">&times;</button>
                </div>
                <div class="modal-tabs">
                    <button class="tab-btn active" data-tab="keybindings">KEY BINDINGS</button>
                    <button class="tab-btn" data-tab="audio">AUDIO</button>
                    <button class="tab-btn" data-tab="graphics">GRAPHICS</button>
                </div>
                <div class="modal-body">
                    <!-- Keybindings Tab -->
                    <div id="tab-keybindings" class="tab-content active">
                        <div class="keybindings-header">
                            <p>Click on a key binding to change it. Press the new key to assign.</p>
                            <div class="keybindings-actions">
                                <button id="reset-all-bindings" class="settings-btn">Reset All to Default</button>
                            </div>
                        </div>
                        <div id="keybindings-list">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <!-- Audio Tab -->
                    <div id="tab-audio" class="tab-content">
                        <div class="settings-row">
                            <label>Master Volume</label>
                            <input type="range" id="master-volume" min="0" max="100" value="50">
                            <span id="volume-value">50%</span>
                        </div>
                        <div class="settings-row">
                            <label>Sound Effects</label>
                            <input type="checkbox" id="sfx-enabled" checked>
                        </div>
                        <div class="settings-row">
                            <label>Music Volume</label>
                            <input type="range" id="music-volume" min="0" max="100" value="12">
                            <span id="music-volume-value">12%</span>
                        </div>
                        <div class="settings-row">
                            <label>Music Enabled</label>
                            <input type="checkbox" id="music-enabled" checked>
                        </div>
                    </div>

                    <!-- Graphics Tab -->
                    <div id="tab-graphics" class="tab-content">
                        <div class="settings-row">
                            <label>UI Scale: <span id="ui-scale-value">100%</span></label>
                            <input type="range" id="ui-scale-slider" min="80" max="150" step="5" value="100">
                        </div>
                        <div class="settings-row">
                            <label>Show Scanlines</label>
                            <input type="checkbox" id="scanlines-enabled">
                        </div>
                        <div class="settings-row">
                            <label>Particle Density</label>
                            <select id="particle-density">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Rebind Overlay -->
        <div id="rebind-overlay" class="hidden">
            <div class="rebind-dialog">
                <div class="rebind-title">Press a key for:</div>
                <div id="rebind-action-name"></div>
                <div class="rebind-hint">Press Escape to cancel</div>
            </div>
        </div>

        <!-- Ship Menu Modal -->
        <div id="ship-menu-modal" class="modal hidden">
            <div class="modal-content ship-menu-modal">
                <div class="modal-header">
                    <span>SHIP MENU</span>
                    <button class="modal-close" id="ship-menu-close">&times;</button>
                </div>
                <div class="modal-tabs">
                    <button class="tab-btn active" data-tab="stats">STATS</button>
                    <button class="tab-btn" data-tab="inventory">INVENTORY</button>
                    <button class="tab-btn" data-tab="drones">DRONES</button>
                </div>
                <div class="modal-body">
                    <div id="ship-tab-stats" class="tab-content active">
                        <div class="ship-stats-layout">
                            <div class="ship-viewer-container">
                                <canvas id="ship-viewer-canvas"></canvas>
                                <div id="ship-menu-name" class="ship-viewer-name">Your Ship</div>
                            </div>
                            <div class="ship-info-columns">
                                <div class="ship-stats-column">
                                    <div id="ship-stats-content"></div>
                                </div>
                                <div class="ship-modules-column">
                                    <h3>FITTED MODULES</h3>
                                    <div id="ship-modules-content"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="ship-tab-inventory" class="tab-content">
                        <h3>CARGO HOLD</h3>
                        <div id="ship-inventory-content"></div>
                    </div>
                    <div id="ship-tab-drones" class="tab-content">
                        <!-- Populated dynamically by ShipMenuManager -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Model Editor Modal -->
        <div id="model-editor-modal" class="modal hidden">
            <div class="modal-content model-editor-modal">
                <div class="modal-header">
                    <span>MODEL EDITOR</span>
                    <button class="modal-close" id="model-editor-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="model-editor-layout">
                        <div class="model-editor-viewports">
                            <div class="model-editor-viewport">
                                <div class="viewport-label">3D PREVIEW <span class="viewport-hint">drag to rotate, scroll to zoom</span></div>
                                <canvas id="model-editor-3d-canvas"></canvas>
                            </div>
                            <div class="model-editor-viewport">
                                <div class="viewport-label">TOP-DOWN (GAME VIEW) <span class="viewport-hint">scroll to zoom</span></div>
                                <canvas id="model-editor-topdown-canvas"></canvas>
                            </div>
                        </div>
                        <div class="model-editor-controls">
                            <div class="editor-control-group">
                                <label>Model Path</label>
                                <div class="editor-path-row">
                                    <input type="text" id="editor-model-path" placeholder="assets/ships/...">
                                    <button id="editor-load-btn" class="buy-btn">LOAD</button>
                                </div>
                                <div id="editor-model-list" class="editor-model-list"></div>
                            </div>
                            <div class="editor-control-group">
                                <label>Rotation X: <span id="editor-rx-val">0</span>&deg;</label>
                                <input type="range" id="editor-rx" min="-180" max="180" value="0" step="1">
                            </div>
                            <div class="editor-control-group">
                                <label>Rotation Y: <span id="editor-ry-val">0</span>&deg;</label>
                                <input type="range" id="editor-ry" min="-180" max="180" value="0" step="1">
                            </div>
                            <div class="editor-control-group">
                                <label>Rotation Z: <span id="editor-rz-val">0</span>&deg;</label>
                                <input type="range" id="editor-rz" min="-180" max="180" value="0" step="1">
                            </div>
                            <div class="editor-control-group">
                                <label>Scale: <span id="editor-scale-val">1.0</span></label>
                                <input type="range" id="editor-scale" min="0.1" max="5" value="1" step="0.1">
                            </div>
                            <div class="editor-control-group editor-brightness-group">
                                <label>Brightness: <span id="editor-brightness-val">2.5</span></label>
                                <input type="range" id="editor-brightness" min="0.5" max="6" value="2.5" step="0.1">
                            </div>
                            <div class="editor-control-group">
                                <label>Assign to Ship</label>
                                <select id="editor-ship-select" class="market-filter-select" style="width:100%"></select>
                            </div>
                            <div class="editor-buttons">
                                <button id="editor-save-btn" class="buy-btn large">SAVE ORIENTATION</button>
                                <button id="editor-assign-btn" class="buy-btn">ASSIGN TO SHIP</button>
                                <button id="editor-reset-btn" class="buy-btn">RESET</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sector Map Modal -->
        <div id="sector-map-modal" class="modal hidden">
            <div class="modal-content map-modal">
                <div class="modal-header">
                    <span>SECTOR MAP</span>
                    <button class="modal-close" id="sector-map-close">&times;</button>
                </div>
                <div class="modal-tabs">
                    <button class="tab-btn active" data-tab="local">LOCAL</button>
                    <button class="tab-btn" data-tab="universe">UNIVERSE</button>
                </div>
                <div class="modal-body map-modal-body">
                    <div id="map-tab-local" class="tab-content active">
                        <div class="map-canvas-container">
                            <canvas id="local-map-canvas"></canvas>
                        </div>
                        <div class="map-controls">
                            <button id="local-zoom-in" class="map-control-btn" title="Zoom In">+</button>
                            <button id="local-zoom-out" class="map-control-btn" title="Zoom Out">-</button>
                            <button id="local-center" class="map-control-btn" title="Center on Ship">&#8982;</button>
                        </div>
                    </div>
                    <div id="map-tab-universe" class="tab-content">
                        <div class="map-canvas-container">
                            <canvas id="universe-map-canvas"></canvas>
                        </div>
                        <div class="map-overlays" id="map-overlays">
                            <label class="map-overlay-toggle"><input type="checkbox" id="overlay-faction"> Faction</label>
                            <label class="map-overlay-toggle"><input type="checkbox" id="overlay-trade"> Trade</label>
                            <label class="map-overlay-toggle"><input type="checkbox" id="overlay-threat"> Threat</label>
                            <label class="map-overlay-toggle"><input type="checkbox" id="overlay-resources"> Resources</label>
                            <label class="map-overlay-toggle"><input type="checkbox" id="overlay-events"> Events</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Three.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <!-- Game Scripts -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
